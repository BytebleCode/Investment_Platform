[uwsgi]
# uWSGI Configuration for Production
# Alternative to Gunicorn for mainframe deployment
#
# Usage:
#   uwsgi --ini uwsgi.ini

# Application
module = wsgi:app
callable = app

# Process management
master = true
processes = 4
threads = 2
enable-threads = true

# Socket configuration
# Use socket for nginx proxy, http for direct access
socket = /var/run/investment-platform/uwsgi.sock
chmod-socket = 660
# http = 0.0.0.0:8000

# Process naming
procname-prefix-spaced = investment-platform

# Memory management
reload-on-rss = 200
max-requests = 1000
harakiri = 120
harakiri-verbose = true

# Logging
logto = /var/log/investment-platform/uwsgi.log
log-format = %(addr) - %(user) [%(ltime)] "%(method) %(uri) %(proto)" %(status) %(size) "%(referer)" "%(uagent)" %(msecs)ms

# Buffer sizes
buffer-size = 32768
post-buffering = 8192

# Stats server (for monitoring)
stats = /var/run/investment-platform/uwsgi-stats.sock
stats-http = true

# Cleanup
vacuum = true
die-on-term = true

# Security
chdir = /app
uid = uwsgi
gid = uwsgi

# Python specific
single-interpreter = true
lazy-apps = true

# Thunder lock (prevents thundering herd)
thunder-lock = true

# Cheaper (dynamic worker scaling)
cheaper-algo = spare
cheaper = 2
cheaper-initial = 2
cheaper-step = 1
workers = 4

# Caching (optional, for response caching)
# cache2 = name=apicache,items=100,blocksize=4096

# SSL (uncomment for HTTPS)
# https = 0.0.0.0:443,/path/to/cert.pem,/path/to/key.pem,HIGH
